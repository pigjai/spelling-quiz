<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>æ‹¼å­—ç·´ç¿’éŠæˆ²</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 2em; }
    input, button, select { font-size: 1.2em; margin: 0.5em; padding: 0.4em; }
    #game, #nextBtn { display: none; }
    #timer { font-size: 1.4em; color: #d9534f; font-weight: bold; }
    .correct { color: green; }
    .wrong { color: red; }
    .timeout { color: orange; }
  </style>
</head>
<body>
  <h1>ğŸ”¤ æ‹¼å­—ç·´ç¿’</h1>
  <div id="startBox">
    <p>è«‹é¸æ“‡å–®å­—æ¸…å–®ï¼š</p>
    <select id="listSelect">
      <option value="Level1to4">Level 1â€“4</option>
      <option value="Level5">Level 5</option>
      <option value="Level6">Level 6</option>
    </select><br>
    <button onclick="startGame()">é–‹å§‹éŠæˆ²</button>
  </div>

  <div id="game">
    <p><strong>é¡Œç›® <span id="indexText"></span></strong></p>
    <button onclick="playAudio()">â–¶ï¸ æ’­æ”¾èªéŸ³</button><br>
    <input type="text" id="answer" placeholder="è¼¸å…¥æ‹¼å­—..." />
    <button onclick="submitAnswer()">æäº¤</button>
    <div id="timer"></div>
    <div id="resultBox" style="margin-top:1em; font-weight: bold;"></div>
    <button id="nextBtn" onclick="nextWord()">ä¸‹ä¸€é¡Œ</button>
  </div>

  <script>
    const audioLists = {
      Level1to4: "https://pigjai.github.io/spelling-audio/level1to4.json",
      Level5: "https://pigjai.github.io/spelling-audio/level5.json",
      Level6: "https://pigjai.github.io/spelling-audio/level6.json"
    };

    let words = [], current = 0, correct = 0, timer, countdown = 12;
    let answerLog = [];

    function startGame() {
      const level = document.getElementById("listSelect").value;
      fetch(audioLists[level])
        .then(res => res.json())
        .then(data => {
          words = shuffle([...data]);
          current = 0;
          correct = 0;
          answerLog = [];
          document.getElementById("startBox").style.display = "none";
          document.getElementById("game").style.display = "block";
          loadWord();
        })
        .catch(err => alert("è¼‰å…¥å¤±æ•—ï¼š" + err.message));
    }

    function shuffle(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function loadWord() {
      document.getElementById("answer").value = "";
      document.getElementById("resultBox").textContent = "";
      document.getElementById("resultBox").className = "";
      document.getElementById("nextBtn").style.display = "none";
      document.getElementById("indexText").textContent = `${current + 1} / ${words.length}`;
      startTimer();
    }

    function playAudio() {
      const audio = new Audio(words[current].audio);
      audio.play().catch(e => {
        alert("âš ï¸ ç„¡æ³•æ’­æ”¾éŸ³è¨Šï¼š\n" + e.message + "\nğŸ”— " + words[current].audio);
      });
    }

    function startTimer() {
      clearInterval(timer);
      countdown = 12;
      document.getElementById("timer").textContent = `â± å‰©é¤˜ ${countdown} ç§’`;
      timer = setInterval(() => {
        countdown--;
        document.getElementById("timer").textContent = `â± å‰©é¤˜ ${countdown} ç§’`;
        if (countdown <= 0) {
          clearInterval(timer);
          submitAnswer(true);
        }
      }, 1000);
    }

    function submitAnswer(timeout = false) {
      clearInterval(timer);
      const input = document.getElementById("answer").value.trim();
      const correctWord = words[current].word;
      const resultBox = document.getElementById("resultBox");

      let status, message;
      if (timeout) {
        status = "timeout";
        message = `âŒ› æ™‚é–“åˆ°ï¼æ­£ç¢ºæ˜¯ï¼š${correctWord}`;
      } else if (input.toLowerCase() === correctWord.toLowerCase()) {
        status = "correct";
        message = "âœ… æ­£ç¢ºï¼";
        correct++;
      } else {
        status = "wrong";
        message = `âŒ éŒ¯èª¤ï¼Œæ­£ç¢ºæ˜¯ï¼š${correctWord}`;
      }

      answerLog.push({ word: correctWord, input: input || "(ç©ºç™½)", result: status });
      resultBox.textContent = message;
      resultBox.className = status;
      resultBox.style.display = "block";
      document.getElementById("nextBtn").style.display = "inline-block";
    }

    function nextWord() {
      current++;
      if (current >= words.length) {
        showFinalResults();
        return;
      }
      loadWord();
    }

    function showFinalResults() {
      const game = document.getElementById("game");
      let html = `ğŸ‰ å…¨éƒ¨å®Œæˆï¼<br>ä½ çš„å¾—åˆ†ï¼š${correct} / ${words.length}<br><hr><h3>âœ… å…¨éƒ¨é¡Œç›®ï¼š</h3><ol style="text-align:left;">`;
      for (const item of answerLog) {
        let display = item.result === "correct"
          ? `<b class="correct">âœ… ${item.word}</b>`
          : item.result === "wrong"
          ? `<b class="wrong">âŒ ${item.word}</b>ï¼ˆä½ çš„ç­”æ¡ˆï¼š${item.input}ï¼‰`
          : `<b class="timeout">âŒ› ${item.word}</b>ï¼ˆä½ æœªä½œç­”ï¼‰`;
        html += `<li>${display}</li>`;
      }
      html += "</ol><button onclick='location.reload()'>ğŸ” å†ä¾†ä¸€è¼ª</button>";
      game.innerHTML = html;
    }

    document.getElementById("answer").addEventListener("keydown", function (e) {
      if (e.key === "Enter") submitAnswer();
    });
  </script>
</body>
</html>
